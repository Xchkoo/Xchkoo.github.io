
<!DOCTYPE html>
<html lang="zh-CN" class="loading">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>[题解]洛谷-P3384 模板题重链剖分-线段树 - Xchkoo&#39;s blog</title>
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="google" content="notranslate" />
    <meta name="keywords" content="Xchkoo,Xchkoo.top,blog,"> 
    <meta name="description" content="Xchkoo,讲解视频大约一个小时，需要加载半分钟左右。


原题和值得参考的博客
p3384
oi-wiki 树链剖分
oi-wiki 线段树
参考 树链剖分详解
参考 洛谷优秀题解

代码代码有详细的注释，不,"> 
    <meta name="author" content="Xchkoo"> 
    <link rel="alternative" href="atom.xml" title="Xchkoo&#39;s blog" type="application/atom+xml"> 
    <link rel="icon" href="/img/X.png"> 
    
<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">

    
<link rel="stylesheet" href="/css/diaspora.css">

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
         (adsbygoogle = window.adsbygoogle || []).push({
              google_ad_client: "ca-pub-8691406134231910",
              enable_page_level_ads: true
         });
    </script>
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
<meta name="generator" content="Hexo 5.3.0"></head>

<body class="loading">
    <span id="config-title" style="display:none">Xchkoo&#39;s blog</span>
    <div id="loader"></div>
    <div id="single">
    <div id="top" style="display: block;">
    <div class="bar" style="width: 0;"></div>
    <a class="iconfont icon-home image-icon" href="javascript:;" data-url="http://xchkoo.github.io"></a>
    <div title="播放/暂停" class="iconfont icon-play"></div>
    <h3 class="subtitle">[题解]洛谷-P3384 模板题重链剖分-线段树</h3>
    <div class="social">
        <div>
            <div class="share">
                <a title="获取二维码" class="iconfont icon-scan" href="javascript:;"></a>
            </div>
            <div id="qr"></div>
        </div>
    </div>
    <div class="scrollbar"></div>
</div>

    <div class="section">
        <div class="article">
    <div class='main'>
        <h1 class="title">[题解]洛谷-P3384 模板题重链剖分-线段树</h1>
        <div class="stuff">
            <span>四月 05, 2021</span>
            
  <ul class="post-tags-list" itemprop="keywords"><li class="post-tags-list-item"><a class="post-tags-list-link" href="/tags/hld/" rel="tag">hld</a></li><li class="post-tags-list-item"><a class="post-tags-list-link" href="/tags/luogu-P3384-%E6%A8%A1%E6%9D%BF%E9%A2%98/" rel="tag">luogu-P3384 模板题</a></li><li class="post-tags-list-item"><a class="post-tags-list-link" href="/tags/%E6%87%92%E6%A0%87%E8%AE%B0/" rel="tag">懒标记</a></li><li class="post-tags-list-item"><a class="post-tags-list-link" href="/tags/%E7%BA%BF%E6%AE%B5%E6%A0%91/" rel="tag">线段树</a></li><li class="post-tags-list-item"><a class="post-tags-list-link" href="/tags/%E9%87%8D%E9%93%BE%E5%89%96%E5%88%86/" rel="tag">重链剖分</a></li><li class="post-tags-list-item"><a class="post-tags-list-link" href="/tags/%E9%A2%98%E8%A7%A3/" rel="tag">题解</a></li></ul>


        </div>
        <div class="content markdown">
            <h1 id="讲解"><a href="#讲解" class="headerlink" title="讲解"></a>讲解</h1><p>视频大约一个小时，需要加载半分钟左右。</p>
<iframe src="//player.bilibili.com/player.html?aid=459949113&cid=319890611&page=1&danmaku=0" allowfullscreen="allowfullscreen" width="100%" height="500" scrolling="no" frameborder="0" sandbox="allow-top-navigation allow-same-origin allow-forms allow-scripts"></iframe>

<h1 id="原题和值得参考的博客"><a href="#原题和值得参考的博客" class="headerlink" title="原题和值得参考的博客"></a>原题和值得参考的博客</h1><ul>
<li><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P3384">p3384</a></li>
<li><a target="_blank" rel="noopener" href="https://oi-wiki.org/graph/hld/">oi-wiki 树链剖分</a></li>
<li><a target="_blank" rel="noopener" href="https://oi-wiki.org/ds/seg/">oi-wiki 线段树</a></li>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/chinhhh/p/7965433.html">参考 树链剖分详解</a></li>
<li><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/blog/zengqinyi/solution-p3384">参考 洛谷优秀题解</a></li>
</ul>
<h1 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h1><p>代码有详细的注释，不理解可以看视频。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * © Copyright 2021 Xchkoo All rights reserved.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * AUTHOR: Xchkoo</span></span><br><span class="line"><span class="comment"> * DATE: 2021-04-02</span></span><br><span class="line"><span class="comment"> * LISENSE: CC v4.0 BY-SA https://creativecommons.org/licenses/by-sa/4.0/deed.zh</span></span><br><span class="line"><span class="comment"> * Welcome to my blog -&gt; https://Xchkoo.top/</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstring&gt;/*这个cstring里有个memset是不得不用啊*/</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> mid ((l+r)&gt;&gt;1)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> lson rt&lt;&lt;1,l,mid</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rson rt&lt;&lt;1|1,mid+1,r</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> len (r-l+1)</span></span><br><span class="line"><span class="comment">/* 这段主要是为了线段树，手敲太麻烦了 */</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">size_t</span> <span class="keyword">s_t</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> mem(a,b) memset(a,(b),sizeof(a))</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* START global variate block */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">100000</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">int</span> n, m, r, mod,cnt=<span class="number">1</span>,dfs2_cnt,res=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">int</span> head[MAXN],segment_tree[MAXN&lt;&lt;<span class="number">1</span>],value[MAXN],wt[MAXN],lazy[MAXN&lt;&lt;<span class="number">1</span>],depth[MAXN],father[MAXN],node_size[MAXN],heavy_son[MAXN],array_top[MAXN],id[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="comment">/* END global variate block */</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* START function and class block */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* START tree part */</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Node</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> next, to;</span><br><span class="line">&#125; e[MAXN&lt;&lt;<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add_edge</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v)</span> </span>&#123;</span><br><span class="line">    e[cnt].next = head[u];</span><br><span class="line">    e[cnt].to = v;</span><br><span class="line">    head[u] = cnt; </span><br><span class="line">    cnt++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* END */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* START segment tree part */</span></span><br><span class="line"><span class="comment">/* 实际上我们把线段树函数单独拎出来，将线段树通过一个范围参数传入 */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">pushdown</span><span class="params">(<span class="keyword">int</span> rt,<span class="keyword">int</span> size)</span></span></span><br><span class="line"><span class="function"><span class="comment">/* </span></span></span><br><span class="line"><span class="function"><span class="comment"> * 这块是懒标记,相比起lowbit这个其实好理解一点。</span></span></span><br><span class="line"><span class="function"><span class="comment"> * 懒标记意味着它不会主动更新，它把这个操作储存到结点的lazy属性中（在c++中我们通过使用lazy数组来实现），</span></span></span><br><span class="line"><span class="function"><span class="comment"> * 当有用到这个结点和这个结点的子树时（比如查询的dfs滚到这里了），我们会将懒标记打破，分配到每个它的子树，</span></span></span><br><span class="line"><span class="function"><span class="comment"> * 当这个懒标记滚到叶子结点的时候，懒标记就转换成值加入叶子结点的值属性。</span></span></span><br><span class="line"><span class="function"><span class="comment"> * ————————————————————————————————————————————————————————————————————</span></span></span><br><span class="line"><span class="function"><span class="comment"> * 回到题目可能能更好理解一点，题目的操作3是要给指定的范围加值（1、2要用到hld我们先放着），</span></span></span><br><span class="line"><span class="function"><span class="comment"> * 比方现在的范围是3-8，我们有一条1-10的线段并且我们在这个线段上建立了一棵线段树。</span></span></span><br><span class="line"><span class="function"><span class="comment"> * 于是我们给3、8的lca（最近公共祖先）加个懒标记。</span></span></span><br><span class="line"><span class="function"><span class="comment"> * 现在有个操作要查询3-4的数据，可以，我们于是从root开始向3-4出发</span></span></span><br><span class="line"><span class="function"><span class="comment"> * 在这个时候我们发现root有一个懒标记属性，遵从定义我们把它打碎，分配给子结点</span></span></span><br><span class="line"><span class="function"><span class="comment"> * （注意：我们是在把3-8共同加一个值吧！注意“共同”！）。</span></span></span><br><span class="line"><span class="function"><span class="comment"> * 现在我们查找3-4时就会以这个顺序</span></span></span><br><span class="line"><span class="function"><span class="comment"> *                             1-10-&gt;|1-5  -&gt;|1-3  -&gt;|1-2-...</span></span></span><br><span class="line"><span class="function"><span class="comment"> *                           |       |        |2-3 -&gt;| 2  HERE        </span></span></span><br><span class="line"><span class="function"><span class="comment"> *                           |       |               | 3</span></span></span><br><span class="line"><span class="function"><span class="comment"> *                           |       |3-5  -&gt;|3-4  HERE</span></span></span><br><span class="line"><span class="function"><span class="comment"> *                           |5-10 -...      |4-5-...</span></span></span><br><span class="line"><span class="function"><span class="comment"> * 在同时我们会顺便把懒标记推下去，最终推到2 和 3-4 </span></span></span><br><span class="line"><span class="function"><span class="comment"> * 这里要一个转化：我们是在把3-8共同加一个值，共同意味着3-4这个区间其实要3加一次4加一次，</span></span></span><br><span class="line"><span class="function"><span class="comment"> * 总共要加两次。所以在求和时要乘上子结点个数。</span></span></span><br><span class="line"><span class="function"><span class="comment"> * 理解了的话就看代码吧：</span></span></span><br><span class="line"><span class="function"><span class="comment"> */</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">/* 左右子节点都加上父节点的lazy属性 */</span></span><br><span class="line">    lazy[rt&lt;&lt;<span class="number">1</span>]+=lazy[rt];</span><br><span class="line">    lazy[rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>]+=lazy[rt];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/* 这里是左右结点把lazy打破的过程 </span></span><br><span class="line"><span class="comment">     * 注意：segment_tree是一个线段树结点的值的集合，</span></span><br><span class="line"><span class="comment">     * 不是叶子结点的结点的值 是其子树所有结点的值的和。</span></span><br><span class="line"><span class="comment">     * 所以在传递懒标记的过程中我们应当把这个结点的值也更新了。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    segment_tree[rt&lt;&lt;<span class="number">1</span>]+=lazy[rt]*(size-(size&gt;&gt;<span class="number">1</span>));</span><br><span class="line">    segment_tree[rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>]+=lazy[rt]*(size&gt;&gt;<span class="number">1</span>);</span><br><span class="line">    segment_tree[rt&lt;&lt;<span class="number">1</span>]%=mod;</span><br><span class="line">    segment_tree[rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>]%=mod;</span><br><span class="line">    lazy[rt]=<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(<span class="keyword">int</span> rt,<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span></span></span><br><span class="line"><span class="function"><span class="comment">/*</span></span></span><br><span class="line"><span class="function"><span class="comment"> * 此函数是在建立一棵线段树，</span></span></span><br><span class="line"><span class="function"><span class="comment"> * 因为我们在处理操作3、4时并不需要树链剖分，</span></span></span><br><span class="line"><span class="function"><span class="comment"> * 直接在原来树的基础上就可以了。</span></span></span><br><span class="line"><span class="function"><span class="comment"> */</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(l == r)</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * 当左範圍等于右範圍，</span></span><br><span class="line"><span class="comment">     * 它的范围就是一，也就是一个叶子结点，</span></span><br><span class="line"><span class="comment">     * 这个条件意味着可以结束递归了。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    &#123;</span><br><span class="line">        segment_tree[rt] = wt[l];</span><br><span class="line">        <span class="keyword">if</span>(segment_tree[rt]&gt;mod) segment_tree[rt]%=mod;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * 别忘了题目有取模的操作。</span></span><br><span class="line"><span class="comment">         * 另外取模有个法则 （a+b) mod c = （a mod c + b mod c）mod c</span></span><br><span class="line"><span class="comment">         * 可以用阿贝尔群证明。</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    build(lson);<span class="comment">/* 递归 lson和rson定义在宏里 */</span></span><br><span class="line">    build(rson);</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * 线段树是一棵二叉树，</span></span><br><span class="line"><span class="comment">     * 可以想象、用纸推一下这个性质，</span></span><br><span class="line"><span class="comment">     * 左子树序号一定是父节点的两倍，右子树一定是父节点的两倍加1</span></span><br><span class="line"><span class="comment">     * （在这里因为左子树序号是个偶数，所以它的二进制末位一定是0，</span></span><br><span class="line"><span class="comment">     * 用|位操作符来|1其实就是加1，用位操作符比用+更快，是一个优化）</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    segment_tree[rt]=(segment_tree[rt&lt;&lt;<span class="number">1</span>] + segment_tree[rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>])%mod;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> rt,<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> L,<span class="keyword">int</span> R)</span></span></span><br><span class="line"><span class="function"><span class="comment">/* 查询函数 小写l、r 是查询范围，大写L、R是线段树的范围*/</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(L&lt;=l&amp;&amp;r&lt;=R) &#123; <span class="comment">/* 如果在范围内 加上这个结点的值*/</span></span><br><span class="line">        res+=segment_tree[rt];</span><br><span class="line">        res%=mod;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/* </span></span><br><span class="line"><span class="comment">     * #define lson rt&lt;&lt;1,l,mid</span></span><br><span class="line"><span class="comment">     * #define rson rt&lt;&lt;1|1,mid+1,r </span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">else</span> <span class="comment">/* 如果是在跨范围的就分成两块递归，如果这个结点还有懒标记属性，就先打破懒标记 */</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(lazy[rt])pushdown(rt,len);</span><br><span class="line">        <span class="keyword">if</span>(L&lt;=mid)query(lson,L,R);  </span><br><span class="line">        <span class="keyword">if</span>(R&gt;mid)query(rson,L,R);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">(<span class="keyword">int</span> rt,<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> L,<span class="keyword">int</span> R,<span class="keyword">int</span> k)</span><span class="comment">//1 1 5 0 </span></span></span><br><span class="line"><span class="function"><span class="comment">/* 区间更新函数  大至同理于区间查询函数*/</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(L&lt;=l&amp;&amp;r&lt;=R) &#123;</span><br><span class="line">        lazy[rt]+=k;<span class="comment">/* 这里就是应该用懒标记的地方 */</span></span><br><span class="line">        segment_tree[rt]+=k*len; <span class="comment">/* 乘以个数在pushdown函数中有解释 */</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(lazy[rt]) pushdown(rt,len);<span class="comment">/* 如果有懒标记打破 */</span></span><br><span class="line">        <span class="comment">/* 跨区间就分开处理 */</span></span><br><span class="line">        <span class="keyword">if</span>(L&lt;=mid) update(lson,L,R,k);</span><br><span class="line">        <span class="keyword">if</span>(R&gt;mid) update(rson,L,R,k);</span><br><span class="line">        segment_tree[rt]=(segment_tree[rt&lt;&lt;<span class="number">1</span>]+segment_tree[rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>])%mod;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* END */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* START execute part */</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 这一部分是针对操作1234的实际操作部分，</span></span><br><span class="line"><span class="comment"> * 3、4就是基本的线段树</span></span><br><span class="line"><span class="comment"> * 接下来着重讲1、2操作。</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">query_lca</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> ans=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(array_top[x]!=array_top[y])&#123;<span class="comment">//当两个点不在同一条链上 </span></span><br><span class="line">        <span class="keyword">if</span>(depth[array_top[x]]&lt;depth[array_top[y]])swap(x,y);<span class="comment">//把x点改为所在链顶端的深度更深的那个点</span></span><br><span class="line">        res=<span class="number">0</span>;</span><br><span class="line">        query(<span class="number">1</span>,<span class="number">1</span>,n,id[array_top[x]],id[x]);<span class="comment">//ans加上x点到x所在链顶端 这一段区间的点权和</span></span><br><span class="line">        ans+=res;</span><br><span class="line">        ans%=mod;<span class="comment">//按题意取模 </span></span><br><span class="line">        x=father[array_top[x]];<span class="comment">//把x跳到x所在链顶端的那个点的上面一个点</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//直到两个点处于一条链上</span></span><br><span class="line">    <span class="keyword">if</span>(depth[x]&gt;depth[y])swap(x,y);<span class="comment">//把x点深度更深的那个点</span></span><br><span class="line">    res=<span class="number">0</span>;</span><br><span class="line">    query(<span class="number">1</span>,<span class="number">1</span>,n,id[x],id[y]);<span class="comment">//这时再加上此时两个点的区间和即可</span></span><br><span class="line">    ans+=res;</span><br><span class="line">    <span class="keyword">return</span> ans%mod;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">update_lca</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y,<span class="keyword">int</span> k)</span></span>&#123;<span class="comment">//同上 </span></span><br><span class="line">    k%=mod;</span><br><span class="line">    <span class="keyword">while</span>(array_top[x]!=array_top[y])&#123;</span><br><span class="line">        <span class="keyword">if</span>(depth[array_top[x]]&lt;depth[array_top[y]])swap(x,y);</span><br><span class="line">        update(<span class="number">1</span>,<span class="number">1</span>,n,id[array_top[x]],id[x],k);</span><br><span class="line">        x=father[array_top[x]];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(depth[x]&gt;depth[y])swap(x,y);</span><br><span class="line">    update(<span class="number">1</span>,<span class="number">1</span>,n,id[x],id[y],k);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">query_segment_tree</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">    res=<span class="number">0</span>;</span><br><span class="line">    query(<span class="number">1</span>,<span class="number">1</span>,n,id[x],id[x]+node_size[x]<span class="number">-1</span>);<span class="comment">//子树区间右端点为id[x]+siz[x]-1 </span></span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">update_segment_tree</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> k)</span></span>&#123;<span class="comment">//同上 //4 2</span></span><br><span class="line">    update(<span class="number">1</span>,<span class="number">1</span>,n,id[x],id[x]+node_size[x]<span class="number">-1</span>,k); <span class="comment">//1 1 5 0 0 2</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* END */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* START Heavy-light Decomposition part */</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">hld_dfs1</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> fa, <span class="keyword">int</span> deep)</span></span></span><br><span class="line"><span class="function"><span class="comment">/*</span></span></span><br><span class="line"><span class="function"><span class="comment"> * 这个dfs1用来进行重链剖分的第一次递归，</span></span></span><br><span class="line"><span class="function"><span class="comment"> * 找到重子结点，并把它的heavy son通过数组记录。</span></span></span><br><span class="line"><span class="function"><span class="comment"> * 接下来就可以进行dfs2把heavy son连成heavy_edge。</span></span></span><br><span class="line"><span class="function"><span class="comment"> */</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    depth[x] = deep;<span class="comment">/* lca */</span></span><br><span class="line">    father[x] = fa;<span class="comment">/* 这里的father数组实际上是重链连接起来的关键，详见dfs2 */</span></span><br><span class="line">    node_size[x] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> heavy_son_size = <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=head[x];i;i=e[i].next) &#123;</span><br><span class="line">        <span class="keyword">int</span> to = e[i].to;</span><br><span class="line">        <span class="keyword">if</span>(to == fa) <span class="keyword">continue</span>;<span class="comment">/*若为父亲则跳过*/</span></span><br><span class="line">        hld_dfs1(to, x, deep+<span class="number">1</span>);<span class="comment">/*dfs它的儿子*/</span> </span><br><span class="line">        node_size[x] += node_size[to];<span class="comment">/*把它的儿子size加到它身上,遍历完后就会得到它的size*/</span></span><br><span class="line">        <span class="keyword">if</span>(node_size[to] &gt; heavy_son_size) &#123;</span><br><span class="line">            heavy_son[x]=to;</span><br><span class="line">            heavy_son_size=node_size[to];</span><br><span class="line">            <span class="comment">/* tips:一个父亲只有一个heavy son，</span></span><br><span class="line"><span class="comment">             * 如果有两个大小一样的heavy son，</span></span><br><span class="line"><span class="comment">             * 那就任选一个，不会对结果造成影响。</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">hld_dfs2</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> top)</span></span></span><br><span class="line"><span class="function"><span class="comment">/*</span></span></span><br><span class="line"><span class="function"><span class="comment"> * 这个dfs是用来把heavy son连成heavy_edge的。</span></span></span><br><span class="line"><span class="function"><span class="comment"> * 一个heavy_edge一般有1个属性————顶点</span></span></span><br><span class="line"><span class="function"><span class="comment"> * 我们会记录它，因为链的dfs序是连续的，所以跳的过程也遵循dfs序，</span></span></span><br><span class="line"><span class="function"><span class="comment"> * 所以在接下来的lca中我们可以通过顶点的父亲来跳链。</span></span></span><br><span class="line"><span class="function"><span class="comment"> */</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">/* 接下来这两步是在对原先的序号重编为dfs序</span></span><br><span class="line"><span class="comment">     *（因为这段在一个dfs中，所以dfs2_cnt的自增会保证它是一个dfs序）。</span></span><br><span class="line"><span class="comment">     * top就是我们说的链顶。 -&gt; https://oi-wiki.org/graph/hld/</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    id[x]=++dfs2_cnt;</span><br><span class="line">    wt[dfs2_cnt]=value[x];</span><br><span class="line">    array_top[x] = top;</span><br><span class="line">    <span class="keyword">if</span>(!heavy_son[x]) <span class="keyword">return</span>;</span><br><span class="line">    <span class="comment">/* 没有heavy_son意味着这一条重链我们已经遍历到尾了 */</span></span><br><span class="line">    <span class="comment">/* 按先处理重儿子，再处理轻儿子的顺序递归处理 */</span></span><br><span class="line">    hld_dfs2(heavy_son[x],top);<span class="comment">/* 重儿子 */</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=head[x];i;i=e[i].next)<span class="comment">/* 轻儿子 */</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">int</span> to = e[i].to;</span><br><span class="line">        <span class="keyword">if</span>(to==father[x]||to==heavy_son[x]) <span class="keyword">continue</span>;</span><br><span class="line">        hld_dfs2(to,to);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* END */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* END function and class block */</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* START main block */</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//freopen(&quot;p3384.in&quot;, &quot;r&quot;, stdin);</span></span><br><span class="line">    <span class="comment">//freopen(&quot;p3384.out&quot;, &quot;w&quot;, stdout);</span></span><br><span class="line">    ios::sync_with_stdio(<span class="literal">false</span>);</span><br><span class="line">	<span class="comment">/* n: num of node</span></span><br><span class="line"><span class="comment">     * m: num of the execution</span></span><br><span class="line"><span class="comment">     * r: root&#x27;s serial number</span></span><br><span class="line"><span class="comment">     * p: the mod num</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n &gt;&gt; m &gt;&gt; r &gt;&gt; mod;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)</span><br><span class="line">        <span class="built_in">cin</span> &gt;&gt; value[i];</span><br><span class="line">    <span class="keyword">int</span> a,b;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;n;i++) &#123;</span><br><span class="line">        <span class="built_in">cin</span> &gt;&gt; a &gt;&gt; b;</span><br><span class="line">        add_edge(a,b);</span><br><span class="line">        add_edge(b,a);</span><br><span class="line">    &#125;</span><br><span class="line">    hld_dfs1(r,<span class="number">0</span>,<span class="number">1</span>); <span class="comment">// 2 0 1</span></span><br><span class="line">    hld_dfs2(r,r);</span><br><span class="line">    <span class="comment">/* for exec 1,2 */</span></span><br><span class="line">    build(<span class="number">1</span>,<span class="number">1</span>,n);</span><br><span class="line">    <span class="comment">/* for exec 3,4 */</span></span><br><span class="line">    <span class="keyword">while</span>(m--) &#123;</span><br><span class="line">        <span class="keyword">int</span> x,y,w,exec;</span><br><span class="line">        <span class="built_in">cin</span> &gt;&gt; exec;</span><br><span class="line">        <span class="comment">/* 对操作进行处理：</span></span><br><span class="line"><span class="comment">         * 一共有四个操作</span></span><br><span class="line"><span class="comment">         * 操作1：格式：1 x y z 表示将树从 x 到 y 结点最短路径上所有节点的值都加上 z。</span></span><br><span class="line"><span class="comment">         * 操作2：格式：2 x y 表示求树从 x 到 y 结点最短路径上所有节点的值之和。</span></span><br><span class="line"><span class="comment">         * 操作3：格式：3 x z 表示将以 x 为根节点的子树内所有节点值都加上 z。</span></span><br><span class="line"><span class="comment">         * 操作4：格式：4 x 表示求以 x 为根节点的子树内所有节点值之和</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">if</span>(exec == <span class="number">1</span>)&#123;</span><br><span class="line">            <span class="built_in">cin</span> &gt;&gt; x &gt;&gt; y &gt;&gt; w;</span><br><span class="line">            update_lca(x,y,w);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(exec == <span class="number">2</span>) &#123;</span><br><span class="line">            <span class="built_in">cin</span> &gt;&gt; x &gt;&gt; y;</span><br><span class="line">            <span class="built_in">cout</span> &lt;&lt; query_lca(x,y)&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(exec == <span class="number">3</span>) &#123;</span><br><span class="line">            <span class="built_in">cin</span> &gt;&gt; x &gt;&gt; w;</span><br><span class="line">            update_segment_tree(x,w);<span class="comment">//4 2</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(exec == <span class="number">4</span>) &#123;</span><br><span class="line">            <span class="built_in">cin</span> &gt;&gt; x;</span><br><span class="line">            <span class="built_in">cout</span> &lt;&lt; query_segment_tree(x)&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">cin</span>.get();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* END main block */</span></span><br><span class="line"><span class="comment">//(rt=1, l=1, r=5, L=0, R=-1, k=2)</span></span><br><span class="line"><span class="comment">//Breakpoint 1, update_segment_tree (x=4, k=2) at p3384.cpp:208</span></span><br><span class="line"><span class="comment">//208         update(1,1,n,id[x],id[x]+node_size[x]-1,k);</span></span><br><span class="line"><span class="comment">//(gdb) p id</span></span><br><span class="line"><span class="comment">//$1 = &#123;0, 0, 1, 0 &lt;repeats 100007 times&gt;&#125;</span></span><br><span class="line"><span class="comment">//(gdb) p node_size</span></span><br><span class="line"><span class="comment">//$2 = &#123;0, 0, 1, 0 &lt;repeats 100007 times&gt;&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p> <a href="http://xchkoo.github.io/p3384_2021-04-05/">http://xchkoo.github.io/p3384_2021-04-05/</a> 本作品采用<a rel="license noopener" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议</a>进行许可。</p>

            <!--[if lt IE 9]><script>document.createElement('audio');</script><![endif]-->
            <audio id="audio" loop="1" preload="auto" controls="controls" data-autoplay="false">
                <source type="audio/mpeg" src="">
            </audio>
            
                <ul id="audio-list" style="display:none">
                    
                        
                            <li title='0' data-url='https://link.hhtjim.com/163/1409311773.mp3'></li>
                        
                    
                        
                            <li title='1' data-url='https://link.hhtjim.com/163/1417265541.mp3'></li>
                        
                    
                        
                            <li title='2' data-url='https://link.hhtjim.com/163/2064261972.mp3'></li>
                        
                    
                        
                            <li title='3' data-url='https://link.hhtjim.com/163/1428153831.mp3'></li>
                        
                    
                        
                            <li title='4' data-url='https://link.hhtjim.com/163/1460606296.mp3'></li>
                        
                    
                        
                            <li title='5' data-url='https://link.hhtjim.com/163/1371306566.mp3'></li>
                        
                    
                        
                            <li title='6' data-url='https://link.hhtjim.com/163/28573320.mp3'></li>
                        
                    
                        
                            <li title='7' data-url='https://link.hhtjim.com/163/441102354.mp3'></li>
                        
                    
                        
                            <li title='8' data-url='https://link.hhtjim.com/163/441102355.mp3'></li>
                        
                    
                        
                            <li title='9' data-url='https://link.hhtjim.com/163/441102356.mp3'></li>
                        
                    
                        
                            <li title='10' data-url='https://link.hhtjim.com/163/441102358.mp3'></li>
                        
                    
                        
                            <li title='11' data-url='https://link.hhtjim.com/163/441102359.mp3'></li>
                        
                    
                        
                            <li title='12' data-url='https://link.hhtjim.com/163/441102360.mp3'></li>
                        
                    
                </ul>
            
        </div>
        
    <div id='gitalk-container' class="comment link"
		data-enable='true'
        data-ae='false'
        data-ci='7a61432ab10a4ea8f35f'
        data-cs='b2913eac810df502dde1418253f24e86badb4c79'
        data-r='Xchkoo.github.io'
        data-o='Xchkoo'
        data-a='Xchkoo'
        data-d='true'
    >查看评论</div>


    </div>
    
        <div class='side'>
			<ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%AE%B2%E8%A7%A3"><span class="toc-number">1.</span> <span class="toc-text">讲解</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8E%9F%E9%A2%98%E5%92%8C%E5%80%BC%E5%BE%97%E5%8F%82%E8%80%83%E7%9A%84%E5%8D%9A%E5%AE%A2"><span class="toc-number">2.</span> <span class="toc-text">原题和值得参考的博客</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81"><span class="toc-number">3.</span> <span class="toc-text">代码</span></a></li></ol>	
        </div>
    
</div>


    </div>
</div>
<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"./live2d_models/haruna/33/model.2018.bls-winter.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true},"react":{"opacity":0.7},"log":false});</script></body>

<script src="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>


<script src="//lib.baomitu.com/jquery/1.8.3/jquery.min.js"></script>
<script src="/js/plugin.js"></script>
<script src="/js/typed.js"></script>
<script src="/js/diaspora.js"></script>


<link rel="stylesheet" href="/photoswipe/photoswipe.css">
<link rel="stylesheet" href="/photoswipe/default-skin/default-skin.css">


<script src="/photoswipe/photoswipe.min.js"></script>
<script src="/photoswipe/photoswipe-ui-default.min.js"></script>


<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>
    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">
        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>
        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">
            <div class="pswp__top-bar">
                <!--  Controls are self-explanatory. Order can be changed. -->
                <div class="pswp__counter"></div>
                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
                <button class="pswp__button pswp__button--share" title="Share"></button>
                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>
            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>
            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>
            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>
            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>
        </div>
    </div>
</div>



<script type="text/x-mathjax-config">
    MathJax.Hub.Config({"HTML-CSS": { preferredFont: "TeX", availableFonts: ["STIX","TeX"], linebreaks: { automatic:true }, EqnChunk: (MathJax.Hub.Browser.isMobile ? 10 : 50) },
        tex2jax: { inlineMath: [ ["$", "$"], ["\\(","\\)"] ], processEscapes: true, ignoreClass: "tex2jax_ignore|dno",skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']},
        TeX: {  noUndefined: { attributes: { mathcolor: "red", mathbackground: "#FFEEEE", mathsize: "90%" } }, Macros: { href: "{}" } },
        messageStyle: "none"
    });
</script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>



<!-- Google Analytics -->
<script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'G-B9GY5PFRRK', 'auto');
  ga('send', 'pageview');
</script>
<!-- End Google Analytics -->


</html>
